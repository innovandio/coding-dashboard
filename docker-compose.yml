services:
  postgres:
    image: postgres:17
    environment:
      POSTGRES_USER: operator
      POSTGRES_PASSWORD: operator
      POSTGRES_DB: operator
    ports:
      - "5434:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./db/init.sql:/docker-entrypoint-initdb.d/001-init.sql:ro

  adminer:
    image: adminer
    ports:
      - "8089:8080"
    depends_on:
      - postgres

  openclaw-gateway:
    build:
      context: ./docker/openclaw-gateway
      dockerfile: Dockerfile
    environment:
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
    volumes:
      - openclawdata:/root/.openclaw
      - claudedata:/root/.claude
      - agentdata:/data/agents
    ports:
      - "18789:18789"
    init: true
    restart: unless-stopped
    command:
      - node
      - openclaw.mjs
      - gateway
      - --bind
      - lan
      - --port
      - "18789"
      - --allow-unconfigured

  sandbox-browser:
    build:
      context: https://github.com/openclaw/openclaw.git#main
      dockerfile: Dockerfile.sandbox-browser
    ports:
      - "6080:6080"
      - "9222:9222"
      - "5900:5900"
    shm_size: 2g
    restart: unless-stopped

volumes:
  pgdata:
  agentdata:
  claudedata:
  openclawdata:
